os: linux
group: edge

addons:
  apt:
    packages:
    - libdevmapper-dev

language: rust

cache: cargo

matrix:
    include:
        - rust: stable
          env:
              - CRATE_SUBDIR=devicemapper
              - TASK=fmt
        - rust: stable
          env:
              - CRATE_SUBDIR=devicemapper
              - TASK=build
        - rust: stable
          sudo: required
          env:
              - CRATE_SUBDIR=devicemapper
              - TASK=sudo_test
        - rust: nightly
          env:
              - CRATE_SUBDIR=devicemapper
              - TASK=clippy
        - rust: stable
          env:
              - CRATE_SUBDIR=dm-devices
              - TASK=fmt
        - rust: stable
          env:
              - CRATE_SUBDIR=dm-devices
              - TASK=build
        - rust: stable
          sudo: required
          env:
              - CRATE_SUBDIR=dm-devices
              - TASK=sudo_test
        - rust: nightly
          env:
              - CRATE_SUBDIR=dm-devices
              - TASK=clippy

branches:
    only: master

script: cd ./$CRATE_SUBDIR; make -f Makefile $TASK; cd -
